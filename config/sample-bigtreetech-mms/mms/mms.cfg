#
# ███╗    ███╗ ███╗    ███╗ ██████████╗
# ████╗  ████║ ████╗  ████║ ██╔═══════╝
# ██╔██╗██╗██║ ██╔██╗██╗██║ ██████████╗
# ██║ ╚█╝  ██║ ██║ ╚█╝  ██║ ╚═══════██║
# ██║      ██║ ██║      ██║ ██████████║
# ╚═╝      ╚═╝ ╚═╝      ╚═╝ ╚═════════╝
#

#--------------------------- MMS Configuration ---------------------------#
# Multi-color Material Management System for Klipper
# Adapted for Vivid hardware

#--------------------------- Installation Steps ---------------------------#
# 1. Copy config folder:
#    cp -r ~/klipper/config/sample-bigtreetech-mms ~/printer_data/config
# 2. Add to printer.cfg:
#    [include sample-bigtreetech-mms/mms.cfg]
# 3. Save and restart

#--------------------------- MCU Configuration ---------------------------#
[mcu buffer]
# canbus_uuid: {The can_id refresh from "DEVICES"}                  # Can connect
serial: /dev/serial/by-id/usb-Klipper_stm32f042x6_buffer-if00     # USB connection

[mcu vivid]
# canbus_uuid: {The can_id refresh from "DEVICES"}                  # Can connect
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_vivid-if00      # USB connection

#--------------------------- Temperature Sensors ---------------------------#
[temperature_sensor buffer]
sensor_type: temperature_mcu
sensor_mcu: buffer

[temperature_sensor vivid]
sensor_type: temperature_mcu
sensor_mcu: vivid

#--------------------------- Module Includes ---------------------------#
[include mms-includes.cfg]

#--------------------------- MMS Main Settings ---------------------------#
[mms]
retry_times:       3                                # Stepper control retry attempts (minimum: 2)
slot:              0,1,2,3                          # Slot numbers (SLOT0 through SLOT3)
selector_name:     manual_stepper selector_stepper  # Selector stepper name
drive_name:        manual_stepper drive_stepper     # Drive stepper name

#--------------------------- Buffer Hardware Pins ---------------------------#
outlet:            buffer:PA5     # Buffer outlet and full sensor
buffer_runout:     buffer:PA4     # Buffer runout sensor

#--------------------------- Entry Sensor (Optional) ---------------------------#
# If [filament_switch_sensor entry_sensor] is configured elsewhere,
# remove that section to avoid conflicts.
# Enabling entry_sensor in MMS may lower outlet priority.

# entry_sensor:    EBBCan:gpio21

#--------------------------- Feature Toggles ---------------------------#
fracture_detection_enable:    1   # Inlet fracture detection during load/unload (0=disable, 1=enable)
slot_substitute_enable:       1   # Slot auto-substitution (0=disable, 1=enable)

#--------------------------- MMS Logger Configuration ---------------------------#
[mms logger]
filename:          mms.log        # Base log filename
rotate_when:       midnight       # Log rotation schedule (S, M, H, D, midnight, W{0-6})
backup_count:      5              # Historical logs to retain (0=infinite, not recommended)

#--------------------------- Macros Includes ---------------------------#
[include mms-macros.cfg]
