# ========
# MMS Purge Module Configuration
# ========
# Parameters for purging old filament and preparing for new material
# including purge volumes, priming routines, and purge tray positions
[mms purge]
# Enable/disable the purge module
# 0 = disable, 1 = enable
# When disabled, all purge operations will be skipped
enable: 1

# Z-axis lift distance during cutting operations
# Unit: mm
z_raise: 1.0

# --------
# Cooling Fan Settings
# --------
# Fan speed during cooldown phase
# Value range: 0.0 to 1.0 (0% to 100%)
fan_cooldown_speed: 1.0
# Duration to wait while cooling with fan
# Unit: seconds
fan_cooldown_wait: 2.0

# --------
# Purge Extrusion Settings
# --------
# Extruder speed during filament purging
# Unit: mm/min
purge_speed: 600.0

# --------
# Orphan Filament Settings
# --------
# Orphan filament refers to the residual filament segment
# remaining between the cutter and nozzle after a cutting operation.
# This orphaned segment must be purged (thermally flushed) during the
# subsequent purge process to ensure
# clean filament transition and prevent printing defects.
#
#     | | Extruder | |
#     | | Stepper  | |
#     | +----------+ |
#  ======> Cutter    | ---
#     |              |  |
#      \            /   | orphan filament
#       \  Nozzle  /    | length
#        \        /     |
#         \______/     ---
#
# Length of orphan filament to be purged
# Unit: mm
orphan_filament_length: 60
# Multiplier for purge volume calculation
purge_modifier: 2.5

# --------
# Retraction Compensation
# --------
# Prevents underextrusion after purging by compensating for oozing
# Retracts filament immediately after purging to prevent nozzle dripping
# Should be less than or equal to buffer spring stroke length
# Unit: mm
retraction_compensation: 3.0
# Retraction speed
# Unit: mm/min
retract_speed: 10000.0

# --------
# Nozzle Priming Settings
# --------
# Critical preparation step for multi-material printing
# Eliminates air gaps between filament changes and ensures consistent extrusion
# - Removes trapped air from filament transitions
# - Stabilizes flow before printing resumes
# - Compensates for thermal expansion/contraction effects
# Priming distance
# Unit: mm
nozzle_priming_dist: 20.0
# Priming speed
# Unit: mm/min
nozzle_priming_speed: 600.0

# --------
# Pressure pulse cleaning configuration
# --------
# Uses alternating extrusion/retraction pulses to
# clear material residue from nozzle.
# Particularly useful for preventing cross-contamination
# during filament changes without purge.

# Pause duration between extrusion and retraction pulses
# Allows material time to respond to pressure changes, improving cleaning effectiveness
# Unit: second
pulse_rest_time: 0.1
# Number of complete pulse cycles (extrude-pause-retract-pause)
# More cycles provide more thorough cleaning but take longer
pulse_count: 4
# Speed for extrusion and retraction movements during pulses
# Affects pulse intensity - higher speeds create stronger pressure impulses
# Unit: mm/min
pulse_speed: 1200

# Retraction distance per pulse cycle
# Ensures sufficient retraction to clear excess material from nozzle
# Unit: mm
retract_dist: 10
# Extrusion distance per pulse cycle
# Typically set to 50% of retraction distance to prevent material waste
# Unit: mm
extrude_dist: 5

# --------
# Purge Tray Configuration
# --------
# 0. purge_point: Location where extruder purges excess filament onto tray
# 1. eject_point: Location where purged filament blob is ejected from tray
#
# Diagram of purge tray layout:
# -------------------------------
# |                             |
# | ------                      |
# | |Tray|                      |
# | | 0  |                      |
# | ------                      |
# |   1                         |
# |                             |
# |                             |
# -------------------------------
# X/Y coordinates of the purge tray location
tray_point: (60.0, 300.0)
# X/Y coordinates for ejecting purged filament from tray
eject_point: (60.0, 250.0)

# --------
# Custom Macro
# --------
# ##
# [Optional]
# If "custom_before" is uncommented,
# this custom macro will be executed before MMS_PURGE
# ##
# custom_before: MMS_PURGE_CUSTOM_BEFORE

# ##
# [Optional]
# If "custom_after" is uncommented,
# this custom macro will be executed after MMS_PURGE
# ##
# custom_after: MMS_PURGE_CUSTOM_AFTER


# [gcode_macro MMS_PURGE_CUSTOM_BEFORE]
# gcode:
#     MMS


# [gcode_macro MMS_PURGE_CUSTOM_AFTER]
# gcode:
#     MMS
